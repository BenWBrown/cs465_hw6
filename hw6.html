<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Simple Event Example</title>
      <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>


      <style type="text/css">
      .axis text{
          font-family:sans-serif;
          font-size:11px;
      }
      .axis path,
      .axis line{
        fill:none;
        stroke:gray;
        shape-rendering: crisp-edges;
      }

      circle.selected{
        fill:red;
      }

      circle{
        fill:black;
      }

#controls{
  float:left;
}
#info{
  position:absolute;
  width:300px;
  height:auto;
  padding:10px;
  background-color:white;
  border-radius:10px;
  box-shadow: 4px 4px 10px rgba(0,0,0,0.4);

}

#info.hidden{
  display:none;
}

#info p{
  margin:0px;
  font-family:sans-serif;
  font-size:12px;
}

</style>
  </head>
  <body>
    <div id="visDiv"></div>
<div id="controls">
    Name: <input type="text" id="inputName"><br>
    <button type="button" onclick="drawVis()">Click Me!</button>
    <!--
    <p>X Axis: <select id="xSelect"><optgroup label="Metrics" id="xmetrics"></optgroup></select></p>
    <p>Y Axis: <select id="ySelect"><optgroup label="Metrics" id="ymetrics"></optgroup></select></p>
  -->
</div>



<div id="info" class="hidden">
<p id="state">State</p>
<p><span id="variable1">Variable X</span>: <span id="value1">Value 1</span></p>
<p><span id="variable2">Variable Y</span>: <span id="value2">Value 2</span></p>

</div>
    <script>
    // var foo = function(){
    //   debugger;
    // }
    var globalDataset;
    var visData = [];
    var vis, nestedData;

      var createVis = function(parent, width, height){
        var dataset, xData, yData;

        var margins = {top:20, bottom:60, left: 60, right:20};
        var chartWidth = width - margins.left - margins.right;
        var chartHeight = height - margins.top - margins.bottom;

        var xScale = d3.scale.linear().range([0, chartWidth]);
        var yScale = d3.scale.linear().range([chartHeight, 0]);
        var color = d3.scale.category10();

        var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
        var yAxis = d3.svg.axis().scale(yScale).orient("left");


        var svg = d3.select(parent)
          .append("svg")
          .attr({width:width, height:height});

        var chart = svg.append("g")
          .attr("transform", "translate("+margins.left + "," + margins.top + ")");

        var xAxisG = chart.append("g")
          .attr({"class": "axis",
                  "transform": "translate(0," + chartHeight +")"});

        var yAxisG = chart.append("g")
          .attr({"class": "axis"});


        var vis = function(){

          var xMin = function(d) {return d3.min(d.info, function(d){return +d.Year;})};
          var xMax = function(d) {return d3.max(d.info, function(d){return +d.Year;})};

          xScale.domain([d3.min(dataset, xMin), d3.max(dataset, xMax)]);

          yScale.domain([0, d3.max(dataset, function(d){
            return d3.max(d.info, function(d){
              return +d.Count;}
              );}
            )]);
          //color.domain(d3.keys(dataset));

          var line = d3.svg.line()
            .interpolate("linear")
            .x(function(d) {
             // console.log(d);
              return xScale(+d.Year); })
            .y(function(d) {
              //console.log(d);
              return yScale(+d.Count); });

          var names = chart.selectAll(".name")
            .data(dataset, function(d){return d;});

          names.exit().remove();

          names.enter()
            .append("g")
            .attr("class","name");

        
          names.append("path")
            .attr("class", "line")
            .attr("d", function(d){
              console.log(d);
              return line(d.info)})
            //.attr("data-legend",function(d) {  return "Tree " + d.key})
            .style("fill","None")
            .style("stroke", "black");
            //.style("stroke",function(d){return color(d["Name"]);});

          xAxisG.call(xAxis);
          yAxisG.call(yAxis);
        };


        vis.loadData = function(data){
          dataset = data;
          return vis;
        }

        vis.setX = function(value){
          if (!arguments.length) return xData;
          xData = value;
          return vis;
        }

        vis.setY = function(value){
          if (!arguments.length) return yData;
          yData = value;
          return vis;
        }


        return vis;
      };

      var drawVis = function(){
        var name = document.getElementById('inputName').value;
        if (!name) {name = "Mary";}

            //var name = "Mary";
            var gender = "M";
            var x = nestedData.get(name).get(gender);
            var obj = {"name": name,
                        "gender": gender,
                        "info": x};

            visData.push(obj);

            //console.log(x);

            vis.loadData(visData);
            vis();
      }

      d3.csv("http://www.cs.middlebury.edu/~candrews/classes/infovis/data/names1880-2012.csv",
        function(dataset){
          globalDataset = dataset;
          nestedData = d3.nest()
              .key(function(d){return d.Name;})
              .key(function(d){return d.Gender;})
              .map(globalDataset, d3.map);
          vis = createVis("#visDiv", 400,400);
          drawVis();

          // var xmenu = d3.select("#xmetrics");
          // var ymenu = d3.select("#ymetrics");
          // for (prop in dataset[0]){
          //   if (prop != "State" && prop != "stateAbbr"){
          //     xmenu.append("option").attr("value", prop).text(prop);
          //     ymenu.append("option").attr("value", prop).text(prop);
          //   }
          // }

          // document.getElementById('xSelect').value = "perCollege";
          // document.getElementById('ySelect').value = "income";

          // d3.select("#xSelect").on("change", function(){
          //   vis.setX(this.value);
          //   vis();

          // });

          // d3.select("#ySelect").on("change", function(){
          //   vis.setY(this.value);
          //   vis();

          // });

      });




    </script>
  </body>
</html>
